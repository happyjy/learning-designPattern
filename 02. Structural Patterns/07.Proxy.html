<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        /*
            Latitude ranges


            * [!] 얘를 들어 GeoCoder가 DB 로직이고 
                GeoProxy가 서버 코드라고 한다면
                
                GeoProxy에 요청이 왔을때 geoche에 있는 값이면 db요청을 하지 않아도 되기 때문에 비용을 줄일 수 있겠구나.
        */

        function GeoCoder() {
            this.getLatLng = function (address) {
                if (address === "Paris") {
                    return "53.3700 N, 4.8340 E"
                } else if (address === "London") {
                    return "52.3771 N, 4.8900 E"
                } else if (address === "Amsterdam") {
                    return "51.3171 N, 0.1062 E"
                } else if (address === "Berlin") {
                    return "52.5233 N, 13.4127 E"
                } else {
                    return "";
                }
            }
        }

        function GeoProxy() {
            var geocoder = new GeoCoder();
            var geocache = {};

            return {
                getLatLng: function (address) {
                    if (!geocache[address]) {
                        geocache[address] = geocoder.getLatLng(address);
                    }
                    log.add(address + ": " + geocache[address]);
                    return geocache[address];
                },
                getCount: function () {
                    var count = 0;
                    for (var code in geocache) { count++; }
                    return count;
                }
            }
        }


        var log = (function () {
            var log = '';

            return {
                add: function (msg) { log += msg + '\n' },
                show: function () { console.log(log); log = ''; }
            }
        })();

        function run() {
            var geo = new GeoProxy();
            //  geolocation requests

            geo.getLatLng("Paris");
            geo.getLatLng("London");
            geo.getLatLng("London");
            geo.getLatLng("London");
            geo.getLatLng("London");
            geo.getLatLng("Amsterdam");
            geo.getLatLng("Amsterdam");
            geo.getLatLng("Amsterdam");
            geo.getLatLng("Amsterdam");
            geo.getLatLng("Amsterdam");
            geo.getLatLng("London");
            geo.getLatLng("London");

            log.add("\n Cache size: " + geo.getCount());
            log.show();
        }

        run();
    </script>
</body>

</html>
