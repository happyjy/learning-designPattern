<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        /*
             (권투·레슬링 등의) 플라이급 선수(보통 체중 48-51kg 사이)
        */
        /*
            # Participants

                * Client
                    - Flyweight 객체를 얻기 위해서 FlyweightFactory를 호출
                    - sampleCode:Computer

                * FlyWeightFactory
                    - flyweight 객체를 생성, 관리
                    - sampleCode:FlyweightFactory

                * Flyweight
                    - application 내 데이터를 공유하기 위해서 내재한 data를 유지한다
                    - sampleCode:Flyweight
        */

        /*
            # Sample Code 설명

                * 공통적인 models, makes, processor 부품을 이용해 컴퓨터를 만든다.
                * 그래서 이런 특징들은 Flyweight객체에서 공유/ 관리 된다.fail

                * FlyweightFactory
                    - Flyweight 객체를 관리한다.
                    - FlywidghtFactory에게 Flyweight 객체를 생성해달라고 요청하면 이미 있는지 확인한다.
                    - 없다면 하나 Flyweight 객체를 생성하고 저장해놓는다 다음에 사용할때 다시 사용하기 위해서
                    - 같은 computer를 연속적으로 요청 될때 Flyweight는 같은 Flyweight 객체를 반환한다.fail

                * 여러 다른 컴퓨터들은 ComputerCollection에 추가 된다.
                * 우리는 7개 컴퓨터 객체를 가지고 있고 2개 Flyweights를 공유한다.
                * 이런 저장은 작은 부분이지만, 큰 datasets에서는 큰 메모리 공유는 중요할 수 있다.
                    - [!] 대용량 처리할때 유용하게 사용할 것같다.
        */

        function Flyweight(make, model, processor) {
            this.make = make;
            this.model = model;
            this.processor = processor;
        }

        var FlyWeightFactory = (function () {
            var flyweights = {};

            return {
                get: function (make, model, processor) {
                    if (!flyweights[make + model]) {
                        flyweights[make + model] = new Flyweight(make, model, processor);
                    }
                    return flyweights[make + model];
                },
                getCount: function () {
                    var count = 0;
                    for (var f in flyweights) count++;
                    return count;
                }
            }
        })()


        function ComputerCollection() {
            var computers = {};
            var count = 0;

            // [?] 왜 prototype으로 안했을까? 
            // run에서 하나만 객체 생성해서 일까?
            return {
                add: function (make, model, processor, memory, tag) {
                    computers[tag] = new Computer(make, model, processor, memory, tag);
                    count++;
                },
                get: function (tag) {
                    return computers[tag];
                },
                getCount: function () {
                    return count;
                }
            }
        }


        var Computer = function (make, model, processor, memory, tag) {
            this.flywight = FlyWeightFactory.get(make, model, processor, memory, tag)
            this.memory = memory;
            this.tag = tag;
            this.getMake = function () {
                return this.flywight.make;
            }
        }

        var log = (function () {
            var log = '';

            return {
                add: function (msg) { log += msg + '\n' },
                show: function () { console.log(log); log = ''; }
            }
        })();

        function run() {
            /*
                # ComputerCollection.add(make, model, processor, memory, tag)
                    -> new Computer(make, model, processor, memory, tag)
                    -> FlyWeightFactory.get(make, model, processor)
                    -> new Flywight(make, model, processor)
            */
            var computers = new ComputerCollection();

            computers.add("Dell", "Studio XPS", "Intel", "5G", "Y755OP1");
            computers.add("Dell", "Studio XPS", "Intel", "6G", "Y755OP2");
            computers.add("Dell", "Studio XPS", "Intel", "3G", "Y755OP3");
            computers.add("Dell", "Studio XPS", "Intel", "4G", "Y755OP4");
            computers.add("Dell", "Studio XPS", "Intel", "1G", "Y755OP5");
            computers.add("HP", "Envy", "Intel", "4G", "C12CJ001");
            computers.add("HP", "Envy", "Intel", "2G", "C12CJ2");

            log.add("Computers: " + computers.getCount());
            log.add("Flyweights: " + FlyWeightFactory.getCount());
            log.show();
        }

        run();
    </script>
</body>

</html>
