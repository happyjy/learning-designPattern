<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>

  <script>

    /*
      // POINT1: 계산기 command pattern 에서 현재 값과 연산 기능이 포함된 Command 객체를 stack 자료 형태로 보관

      // POINT1-1: excute하면 수행한 결과값, 수행한 Command 객체를 commands 배열에 stack 자료형태로 보관
      
      // POINT2: Command 객체 생성시 두번째 param에 undo function을 넣어준다.



      # [ ] 추가 기능 구현 해보기 
        * 초기화 이전 값
        * 지금 값 임시 저장 해놓기 등 
    */

    function add(x, y) { return x + y; }
    function sub(x, y) { return x - y; }
    function mul(x, y) { return x * y; }
    function div(x, y) { return x / y; }

    // POINT2: Command 객체 생성시 두번째 param에 undo function을 넣어준다.
    var Command = function (execute, undo, value) {
      this.execute = execute;
      this.undo = undo;
      this.value = value;
    }

    var AddCommand = function (value) {
      return new Command(add, sub, value);
    };
    var SubCommand = function (value) {
      return new Command(sub, add, value);
    };
    var MulCommand = function (value) {
      return new Command(mul, div, value);
    };
    var DivCommand = function (value) {
      return new Command(div, mul, value);
    };


    var Calculator = function () {
      // current: 계산 할 값에 대한 value
      // command: execute시 수행한 연산 stack으로 보관
      // POINT1
      var current = 0;
      var commands = [];

      function action(command) {
        var operationName = command.execute.toString().substr(9, 3);
        return operationName.charAt(0).toUpperCase() + operationName.slice(1);
      }

      // [ ] 여러 객체를 만들지 않을 거라서 prototype에 선언을 하지 않은건가? 
      return {
        execute: function (command) {
          // POINT1-1: excute하면 수행한 결과값, 수행한 Command 객체를 commands 배열에 stack 자료형태로 보관
          current = command.execute(current, command.value);
          commands.push(command);
          log.add("Execute: " + action(command) + ", value: " + command.value);
        },

        undo: function () {
          var command = commands.pop();
          current = command.undo(current, command.value);
          log.add("Undo: " + action(command) + ", value: " + command.value);
        },

        getCurrentValue: function () {
          return current;
        }
      }
    }

    var log = (function () {
      var log = '';
      return {
        add: function (msg) { log += msg + '\n' },
        show: function () { console.log(log + '\n'); log = ''; },
      }

    })();

    function run() {
      var calculator = new Calculator();

      // issue commands
      calculator.execute(new AddCommand(100));
      calculator.execute(new SubCommand(24));
      calculator.execute(new MulCommand(6));
      calculator.execute(new DivCommand(2));
      log.show();

      //reverse last two commands
      calculator.undo();
      log.add('Value: ' + calculator.getCurrentValue());
      log.show();



      calculator.undo();
      log.add('Value: ' + calculator.getCurrentValue());
      log.show();
    }


    run()

  </script>

</body>

</html>