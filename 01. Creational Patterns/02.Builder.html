<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    /*
      # Director
        - Builder's multistep interfae를 통해서 constructs products를 만든다.
        - 구현 코드: Shop

      # Builder

        - 구현 코드: not used in JS

      # ConcreteBuilder
        - multistep builder interface를 구현
        - 프로세서 조합을 유지
        - 새로은 product를 생성해서 반환한다.
        - 구현 코드: CarBuilder, TruckBuilder

      # Products
        - 조합된 객체를 대표
        - 구현 코드: Car, Truck
    */

    // director
    function Shop() {
      this.construct = function (builder) {
        builder.step1();
        builder.step2();
        return builder.get();
      }
    }

    // ConcreteBuilder
    function CarBuilder() {
      this.car = null;

      this.step1 = function () {
        this.car = new Car();
      }

      this.step2 = function () {
        this.car.addParts();
      }

      this.get = function () {
        return this.car;
      }
    }

    // ConcreteBuilder
    function TruckBuilder() {
      this.truck = null;

      this.step1 = function () {
        this.truck = new Truck();
      }

      this.step2 = function () {
        this.truck.addParts();
      }

      this.get = function () {
        return this.truck;
      }
    }

    // Products
    function Car() {
      this.doors = 0;

      this.addParts = function () {
        this.doors = 4;
      }
      this.say = function () {
        log.add(`난 문 ${this.doors}개 달린 차다!`);
      }
    }

    // Products
    function Truck() {
      this.doors = 0;

      this.addParts = function () {
        this.doors = 2;
      }

      this.say = function () {
        log.add(`난 문 ${this.doors}개 달린 차다!`);
      }
    }

    const log = (function () {
      let log = '';

      return {
        add: (msg) => log += msg + "\n",
        show: () => {
          console.log(log);
          log = '';
        }
      }
    })();


    function run() {
      const shop = new Shop();  // director
      const carBuilder = new CarBuilder();  // ConcreteBuilder (생성자 함수 안에서 Products(Car, Truck)생성자 함수를 사용해 객체 생성)
      const truckBuilder = new TruckBuilder(); // ConcreteBuilder (생성자 함수 안에서 Products(Car, Truck)생성자 함수를 사용해 객체 생성)
      const car = shop.construct(carBuilder);
      const truck = shop.construct(truckBuilder);

      car.say();
      truck.say();

      log.show();
    }

    run();


  </script>
</body>

</html>